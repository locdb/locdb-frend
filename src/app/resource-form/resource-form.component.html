<form [formGroup]="resourceForm" (ngSubmit)="onSubmit()">
  <div class="form-group row">
    <label for="resourcetype" class="col-sm-2 col-form-label">Type</label>
    <div class="col-sm-10">

      <select id="resourcetype" class="form-control" formControlName="resourcetype">
        <option *ngFor="let rt of resourceTypes" [value]="rt">{{rt}}</option>
      </select>

    </div>
  </div>
  <div class="form-group row">
    <label for="title" class="col-sm-2 col-form-label">Title</label>
    <div class="col-sm-10">
      <textarea class="form-control" id="title" formControlName="title" style="resize: none;" ></textarea>
    </div>
  </div>
  <div class="form-group row">

    <label for="subtitle" class="col-sm-2 col-form-label">Subtitle</label>
    <div class="col-sm-10">
      <input id="subtitle" class="form-control" formControlName="subtitle">

    </div>

  </div>
  <!-- typeahead partOf -->
  <div class="form-group row">

    <label for="pof" class="col-sm-2 col-form-label">Part of</label>
    <div class="col-sm-10">

      <input id="pof"
             autocomplete="off"
             formControlName="partOf"
             class="form-control"

             [typeahead]="dataSourcePartOf"
             (typeaheadOnSelect)="typeaheadOnSelectPartOf($event)"
             [typeaheadOptionsLimit]="7"
             typeaheadWaitMs="1000"
             typeaheadOptionField="name"
             [placeholder]="placeholderPartOf">

    </div>

  </div>
  <!--   contribs   -->
  <label for="contributors">Contributors</label>
  <div id="contributors" formArrayName="contributors" class="mb-2">
    <!-- <table class="table-condensed" style="width: 100%;"> -->
    <!--   <tbody> -->
    <div class="form-group row" *ngFor="let contributor of contributors.controls; let j = index" [formGroupName]="j">
      <button (click)="removeContributor(j)" type="button" class="close" aria-label="Remove Contributor">
        <span aria-hidden="true">&times;</span>
      </button>
      <div class="col">
        <select class="form-control" formControlName="role">
          <option *ngFor="let r of roleTypes" [value]="r">{{r}}</option>
        </select>
      </div>
      <div class="col">
        <input class="form-control" formControlName="name">
      </div>
      <button (click)="moveFormarrayEntry(j, -1)" type="button" class="close" aria-label="Remove Contributor"
                                                                              style="margin-left: 0px; margin-right: 5px">
        <span aria-hidden="true">&uarr;</span>
      </button>
      <button (click)="moveFormarrayEntry(j, 1)" type="button" class="close" aria-label="Remove Contributor"
                                                                             style="margin-left: 5px; margin-right: 10px">
        <span aria-hidden="true">&darr;</span>
      </button>
      <button (click)="openModal(template, contributor)" type="button" class="close" aria-label="Inspect Contributor">
        <span aria-hidden="true">i</span>
      </button>
    </div>
    <!-- </tbody> -->
    <!-- </table> -->
    <button type="button" class="btn btn-secondary btn-sm" aria-label="Add Contributor" (click)="addContributor()">
      Add Contributor
    </button>
    <!-- <button type="button" class="btn btn-secondary btn-sm pull-right" aria-label="Add Identifier" (click)="openModal(template)">
      Edit Contributor Identifiers ...
      </button> -->
  </div>

  <div class="form-group row">

    <label for="edition" class="col-sm-2 col-form-label">Edition</label>
    <div class="col-sm-10">

      <input id="edition" class="form-control" formControlName="edition">

    </div>

  </div>
  <div class="form-group row">

    <label for="publicationyear" class="col-sm-2 col-form-label">Pub. year</label>
    <div class="col-sm-10">

      <input type="date" id="publicationyear" class="form-control" formControlName="publicationyear">

    </div>

  </div>
  <div class="form-group row">

    <label for="resourcenumber" class="col-sm-2 col-form-label">Number</label>
    <div class="col-sm-10">

      <input id="resourcenumber" class="form-control" formControlName="resourcenumber">

    </div>

  </div>
  <!--   Idents   -->
  <label for="identifiers"> Identifiers </label>
  <div id="identifiers" formArrayName="identifiers" class="mb-2">
    <div class="form-group row" *ngFor="let identifier of identifiers.controls; let j = index" [formGroupName]="j">
      <button (click)="removeIdentifier(j)" type="button" class="close" aria-label="Remove Identifier">
        <span aria-hidden="true">&times;</span>
      </button>
      <div class="col">
        <select class="form-control" formControlName="scheme">
          <option *ngFor="let it of identifierTypes" [value]="it">{{it}}</option>
        </select>
        <!-- <input class="form-control" formControlName="scheme"> -->
      </div>
      <div class="col">
        <input class="form-control" formControlName="literalValue">
      </div>
    </div>
    <div *ngIf="!migrating">
      <button type="button" class="btn btn-secondary btn-sm" aria-label="Add Identifier" (click)="addIdentifier()">
        Add identifier
      </button>
      <button type="button" class="btn btn-secondary btn-sm pull-right" aria-label="Start Migrating" (click)="toggleMigrating()">
        Migrate identifiers from other resource ...
      </button>
    </div>
    <div *ngIf="migrating" class="form-group row">
      <div class="col-sm-1">
        <button type="button" class="btn btn-secondary btn-sm" aria-label="Cancel Migrating" (click)="toggleMigrating()">
          Cancel
        </button>
      </div>
      <div class="col-sm-11">

        <input id="mig"
               autocomplete="off"
               formControlName="migration"
               class="form-control"

               [typeahead]="dataSourceMigration"
               (typeaheadOnSelect)="typeaheadOnSelectMigration($event)"
               [typeaheadOptionsLimit]="10"
               typeaheadWaitMs="1000"
               typeaheadOptionField="name"
               [placeholder]="placeholderMigration">

      </div>
    </div>
  </div>

  <div *ngIf="questions.length" formGroupName="foreignProperties" class="mb-2">
    <hr/>
    <h5> Additional Container properties </h5>
    <div *ngFor="let question of questions">
      <app-question [question]="question" [form]="foreignProperties"></app-question>
    </div>
  </div>


  <div style="margin: 1rem; margin-bottom: 0rem;">
    <div class="row justify-content-between" style="margin-top: 1rem;">
      <div class="col-xs-6 text-left">
        <!-- <button type="button" class="btn btn-warning" (click)="cancel()" [disabled]="submitting"> -->
        <!--   <span class="glyphicon" aria-hidden="true"></span> Cancel -->
        <!-- </button> -->
        <button type="button" class="btn btn-warning" (click)="revert()">
          <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> Reset
        </button>
      </div>
      <div class="col-xs-6 text-right">
        <button type="submit" class="btn btn-primary" [disabled]="!resourceForm.valid">
          <span class="glyphicon glyphicon-save" aria-hidden="true"></span> {{ resource._id ? 'Submit' : 'Migrate' }}
        </button>
      </div>
    </div>
  </div>
</form>

<!-- TODO possibility to save new content TODO formatting TODO change id scheme to selector-->
<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Identifiers of {{agentIdForm.value.name + " (" + agentIdForm.value.role + ")"}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>

  </div>
  <div class="modal-body">
    <form [formGroup]="agentIdForm">
      <div formArrayName="identifiers">
        <div *ngFor="let Id of agentIdForm.get('identifiers').controls; let i=index">
          <div [formGroupName]="i">
            <div class="pull-left">
              <button (click)="removeContributorIdentifier(agentIdForm, i)" type="button" class="close" aria-label="Remove Identifier">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <label class="col-sm-2" style="padding-left: 0px">Scheme</label>
            <select class="form-control" formControlName="scheme" class="col-sm-3">
              <option *ngFor="let i of agentIdentifierTypes" [value]="i">{{i}}</option>
            </select>
            <label class="col-sm-2">Value</label>
            <input formControlName="literalValue" class="col-sm-4"/>
          </div>
        </div>
        <div>
          <label class="col-sm-2" style="padding-left: 0px">Scheme</label>
          <select class="form-control" class="col-sm-3" #addSelector>
            <option *ngFor="let i of agentIdentifierTypes" [value]="i">{{i}}</option>
          </select>
          <label class="col-sm-2">Value</label>
          <input class="col-sm-4" #addLitValue/>
          <button (click)="addContributorIdentifier(agentIdForm, addSelector.value, addLitValue.value)"
                 type="button" class="close" aria-label="add Identifier">
            <span aria-hidden="true">&oplus;</span>
          </button>
        </div>
        <button (click)="modalRef.hide()" class="pull-right">
          Confirm
        </button>
      </div>
    </form>
  </div>

</ng-template>

