<!-- Panel heading including search bar -->
<div class="card">
<div class="card-header">
  <div class="row" style="">
    <div class="form-group col-md-1" style="padding-right: 0px">
  <button type="button" class="btn btn-block mx-auto" (click)="toggle_extended_search()" style="height: 100px;">
    <i *ngIf="!search_extended" class="fa fa-angle-double-down"></i>
    <i *ngIf="search_extended" class="fa fa-angle-double-up"></i>
  </button>
  </div>
    <div class="col-md-10" style="padding: 0px">
      <div class="form-group">
        <textarea class="form-control" [(ngModel)]="query" rows="3" style="resize: none;"></textarea>
      </div>
    </div>
    <div class="col-md-1" style="padding-left: 0px">
      <button type="button" class="btn btn-success btn-block mx-auto" aria-label="Search" (click)="refresh()" style="height: 100px;">
        <i class="fa fa-search"></i>
      </button>
    </div>

  </div>
  <div class="row" style="">
      <div class="form-group col-md-4">
      <label *ngIf="search_extended" class="center-block">Confidence threshold for internal
        <input class="form-control" type="number" min=0.0 step=0.1 [(ngModel)]="internalThreshold">
      </label>
      </div>
      <div class="form-group col-md-6">
      <label *ngIf="search_extended" class="center-block">... and for external Suggestions
        <input class="form-control" type="number" min=0.0 step=0.1 max=1.0 [(ngModel)]="externalThreshold">
      </label>
  </div>
  <div class="col-md-2">
    <popover-content #searchPopover [closeOnClickOutside]="true">
      <a href="{{'https://scholar.google.com/scholar?q='+encodeURI(query)}}"
      target="_blank" style="target-new: tab;" class="btn float-right" role="button"
      (click)="logAskOthers()">Google Scolar</a>
    </popover-content>
    <button *ngIf="search_extended" type="button" [popover]="searchPopover" class="btn float-right">
      Ask Others</button>
    </div>
        <!-- <div class="form-group col-md-1">
      <button type="button" class="btn" (click)="toggle_extended_search()">
        <i *ngIf="!search_extended" class="fa fa-angle-double-down"></i>
        <i *ngIf="search_extended" class="fa fa-angle-double-up"></i>
      </button>
      </div> -->
  </div>
</div>
<div class="card-body" style="height: 800px; overflow-y: scroll;">
  <!-- Panel body providing suggestions -->
  <div class="row" *ngIf="currentTarget[1]">
  <div class="col-md-12">
  <div *ngIf="currentTarget" class="card-block">
    <h5 class="card-title">
      Currently references
    </h5>
    <app-resource-card [(resources)]="currentTarget"
        [selected]="currentTarget[1] == selectedResource"
    (click)="onSelect(currentTarget[1])">
    </app-resource-card>
  </div>
</div>
</div>
<div class="row">
<div class="col-md-12">
  <div class="card-block">
    <h4 class="card-title">
      Suggestions
    </h4>
    <div *ngFor="let r of internalSuggestions;let i = index">
      <app-resource-card *ngIf="max_in <= 0 || i < max_in"
        [resources]="r" [selected]="r[1] == selectedResource" (click)="onSelect(r[1])">
      </app-resource-card>
    </div>
    <button type="button" *ngIf="max_in == max_shown_suggestions"
    class="list-group-item list-group-item-action list-group-item-default text-center"
    (click)="toggle_max_in()">
      <p><em>Show all</em></p>
    </button>
    <button type="button" *ngIf="max_in == 0"
    class="list-group-item list-group-item-action list-group-item-default text-center"
    (click)="toggle_max_in()">
      <p><em>Show less</em></p>
    </button>
    <div *ngIf="internalInProgress" class="loader">
    </div>
  </div>
</div>
</div>
<hr/>
  <div class="row">
  <div class="col-md-12">
  <div class="card-block">
    <h4 class="card-title">
      External Suggestions
    </h4>
    <div *ngIf="externalSuggestions">
    <div *ngFor="let r of externalSuggestions;let i = index">
      <app-resource-card *ngIf="max_ex <= 0 || i < max_ex"
        [resources]="r" [selected]="r[1] == selectedResource"
        (click)="onSelect(r[1])">
      </app-resource-card>
    </div>
    <button type="button" *ngIf="max_ex == max_shown_suggestions"
    class="list-group-item list-group-item-action list-group-item-default text-center"
    (click)="toggle_max_ex()">
      <p><em>Show all</em></p>
    </button>
    <button type="button" *ngIf="max_ex == 0"
    class="list-group-item list-group-item-action list-group-item-default text-center"
    (click)="toggle_max_ex()">
      <p><em>Show less</em></p>
    </button>
  </div>
    <div *ngIf="externalInProgress" class="loader">
    </div>
  </div>
</div>
</div>
<hr/>

<div class="row" *ngIf="newResource">
  <div class="col-md-12">
    <div class="card-block">
      <h4 class="card-title">
        New resource from reference metadata
      </h4>
      <app-resource-card [resources]="newResource"
      [selected]="newResource[1] === selectedResource"
      (click)="onSelect(newResource[1])">
      </app-resource-card>
    </div>
  </div>
</div>

<div class="row" *ngIf="newResource[1] == null">
  <div class="col-md-12">
    <button type="button" class="btn btn-secondary"
    (click)="openModal(template)" [disabled]="!entry">
      <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
      Create Resource
    </button>
  </div>
</div>
</div> <!-- end card body -->
<!-- Panel footer allowing actions -->
<div class="card-footer">
  <div class="text-right">
    <button type="button" class="btn btn-primary" [disabled]="!selectedResource"
    (click)="commit()">
      <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
      Commit Link
    </button>
  </div>
</div>
<div *ngIf="committed" class="alert alert-success" role="alert">
  <strong>Link committed.</strong>
</div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Select Type of new Resource</h4>
    <button type="button" class="close pull-right" aria-label="Close"
    (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <!-- <label> Resource Type: </label>

        <select name="modaltypeselect" [(ngModel)]="resourceType">
        <option *ngFor="let rt of resourceTypes" [value]="rt">{{rt}}</option>
        </select> -->

        <app-resource-form-basic [resource]="newResource[1]" (resourceChanged)="create_resourse($event)"></app-resource-form-basic>
      <!-- <button type="button" class="btn btn-primary" (click)="modalRef.hide(); openModal(template)">Select Files</button> -->
  </div>
  <!-- <div class="modal-footer">
    <button type="button" class="btn btn-primary float-right" (click)="create_resourse()" [disabled]="!resourceType">Confirm </button>
  </div> -->

</ng-template>
